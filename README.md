# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


# Паттерн MVP (Model-View-Presenter)
## Базовые Классы

###  Класс Api 
обеспечивает взаимодействие приложения с сервером через HTTP-протокол. Он содержит атрибут конфигурации, который включает в себя URL-адрес сервера и базовые заголовки для запросов. А именно, класс имеет следующие свойства:
 	  * baseUrl: string; // основной адрес сервера
 	  * options: RequestInit; // параметры HTTP-запроса
	   * handleResponse: (response: Response) => Promise<object>; // отвечает за обработку ответа от сервера
	   * get: (uri: string) => Promise<object>; // выполняет GET-запрос
	   * post: (uri: string, data: object, method: ApiPostMethods = 'POST') => Promise<object>; // выполняет POST-запрос
	   Реализовывает методы:
	   * get для получения с сервера, принимающий параметр uri,
	   * post для отправки данных на сервер, принимающий uri ссылку, объект данных и метод запроса, а также метод handleResponse для обработки полученного ответа от сервера в методах get и post. Конструктор класса принимает базовый URL запроса, также опции запроса и присваивает их соответствующим параметрам объекта класса.

### Класс Component
Это абстрактный базовый класс, предназначенный для создания пользовательских компонентов, взаимодействующих с элементами DOM. Основные методы включают:

 - toggleClass(element: HTMLElement, className: string, force?: boolean): меняет состояние указанного класса у элемента. Если параметр force задан, класс будет добавлен или убран в зависимости от его значения.
 - setText(element: HTMLElement, value: unknown): обновляет текстовое содержимое элемента.
 - setDisabled(element: HTMLElement, state: boolean): изменяет состояние блокировки элемента.
 - setHidden(element: HTMLElement): скрывает элемент.
 - setVisible(element: HTMLElement): делает элемент видимым.
 - setImage(element: HTMLImageElement, src: string, alt?: string): обновляет изображение и альтернативный текст для элемента.
 - render(data?: Partial<T>): HTMLElement: отвечает за рендеринг компонента, принимая необязательные данные для обновления состояния и возвращает корневой DOM-элемент.

### Класс Model
Модель представляет собой абстрактный класс для создания моделей данных, поддерживающих события. Он предназначен для управления данными и уведомления других компонентов о их изменениях.
Model:
Основной класс для создания моделей данных.
Метод emitChanges(), который уведомляет об изменениях.

> Таким образом, классы Model и Component создают основу для работы с данными и визуальными элементами веб-приложения, обеспечивая возможность управления состоянием и представлением.
   
### Класс EventEmitter
Класс EventEmitter предоставляет механизмы для управления событиями в приложении. Он включает в себя методы для добавления и удаления обработчиков событий, инициирования событий и их прослушивания. Основные характеристики:

Свойство _events: структура данных (Map), в которой хранятся события и соответствующие подписчики (Set).
Методы:

 - on<T extends object>(eventName: EventName, callback: (event: T) => void): регистрирует обработчик для указанного события.
 - off(eventName: EventName, callback: Subscriber): отменяет регистрацию обработчика для события.
 - emit<T extends object>(eventName: string, data?: T): инициирует событие с заданными данными, вызывая все зарегистрированные обработчики для этого события.
 - onAll(callback: (event: EmitterEvent) => void): устанавливает глобальный обработчик для всех событий.
 - offAll(): очищает все обработчики, сбрасывая карту _events.
 - trigger<T extends object>(eventName: string, context?: Partial<T>): возвращает функцию, которая вызывает emit для определённого события с контекстом.



## Классы слоя данных
### Класс LarekApi 
наследует функциональность класса Api. В его конструктор передаются два параметра: URL CDN и базовый URL.
LarekApi предназначен для работы с API приложения и загрузки данных о товарах и списках товаров. Он учитывает расположение CDN для корректного указания путей к изображениям товаров, обеспечивая взаимодействие с внешними сервисами и источниками данных. LarekApi содержит единственное доступное только для чтения свойство cdn и следующие методы:
 - getProductItem(id: string): Promise<ICard>: Данный метод получает данные о товаре по его идентификатору (id) и возвращает объект с данными о товаре (ICard), включая путь к изображению, который представляет собой полный URL, построенный на основе CDN и пути к изображению.
 - getCardList(): Promise<ICard[]>: Этот метод получает список товаров из API и возвращает массив объектов с данными о товарах (ICard[]), включая полные URL-адреса изображений товаров, сформированные на основе CDN и путей к изображениям.
 - orderProducts(order: IOrder): Данный метод выполняет отправку заказа на сервер. Он принимает объект order типа IOrder, который содержит информацию о заказе, и затем выполняет POST-запрос к серверу, отправляя этот объект.

### Класс AppState
, наследующий от класса Model, управляет состоянием приложения, включая информацию о заказах, каталогах товаров, ошибках форм, карточках для превью и корзине. Он включает в себя следующие свойства и методы:
 - Свойства:

	 - items: ICard[] — массив всех доступных товаров.
	 - catalog: ICard[] — массив, представляющий каталог товаров.
	 - basket: ICard[] — массив, представляющий корзину покупок.
	 - preview: string | null — идентификатор товара для предварительного просмотра (может быть null).
	 - order: IOrder — объект, содержащий информацию о текущем заказе (email, телефон, адрес, способ оплаты, общая стоимость и перечень товаров).


 - Методы:
	 - setItems(items: ICard[]): ICard[] — обновляет список отображаемых товаров.
	 - setPreview(item: ICard): void — устанавливает товар для предварительного просмотра.
	 - addToBasket(item: ICard): void — добавляет товар в корзину.
	 - removeItem(id: string): void — удаляет товар из корзины по идентификатору.
	 - getTotal(): number — вычисляет общую стоимость товаров в корзине.
	 - validatePaymentForm(): boolean — проверяет, есть ли ошибки в форме оплаты, и генерирует соответствующие события.
	 - validateContactsForm(): boolean — проверяет форму контактных данных на ошибки и генерирует соответствующие события.
	 - isItemSelected(item: ICard): boolean — проверяет, выбран ли указанный товар.
	 - setAddress(value: string): void — устанавливает адрес доставки.
	 - setPaymentMethod(method: string): void — устанавливает способ оплаты.
	 - setContacts(field: keyof IContact, value: string): void — устанавливает значение указанного поля контактных данных с проверкой формы.
	 - setOrderData(): void — формирует данные заказа на основе элементов в корзине и их общей стоимости.
	 - clearOrderForm(): void — очищает данные формы заказа.
	 - clearOrder(): void — очищает корзину и всю информацию о заказе.

### Form
абстрактный класс, отвечающий за создание экземпляра формы, обрабатывает ввод данных от пользователя и демонстрирует сообщения об ошибках. Он принимает два параметра: container (HTML-элемент формы) и events (объект для обработки событий). Класс предоставляет следующие методы и свойства:


 - valid: свойство, управляющее доступностью кнопки отправки формы.
 - errors: свойство для установки сообщений об ошибках.
 - render(state: Partial<T> & IForm): метод, который отображает форму с учетом переданного состояния.
Кроме того, в классе реализованы внутренние методы для обработки событий ввода данных и отправки формы. Эти методы генерируют соответствующие события, позволяя другим частям приложения реагировать на изменения в форме.




## Классы слоя отображения
### Класс Modal
предназначен для управления модальными окнами в приложении. Он предоставляет методы для открытия, закрытия и обновления содержимого модального окна, а также обеспечивает обработку различных событий. Внутри класса имеются следующие свойства: _content, которое хранит текущее содержимое модального окна, и closeButton, отвечающее за кнопку закрытия окна. Класс включает в себя следующие ключевые методы:

 - openModal(): этот метод открывает модальное окно;
 - closeModal(): закрывает модальное окно, реагируя на нажатие на оверлей или кнопку закрытия;
 - render(changeButton): отвечает за отображение содержимого модального окна, в зависимости от контекста его вызова — будь то карточка товара или корзина покупок;
 - setter content: позволяет установить содержимое модального окна, заменяя текущее значение свойства _content на переданный HTML-элемент value.
Этот класс предоставляет гибкий и удобный способ работы с модальными окнами, позволяя разработчикам легко внедрять их в интерфейс приложения.

### Класс Basket
предназначен для управления корзиной покупок в приложении, обеспечивая функционал добавления и удаления товаров, а также отображение их в списке. Он включает три основных свойства: _list, представляющий собой HTML-элемент, в который будут помещены товары; _total, элемент для вывода общей стоимости товаров; и _button, HTML-кнопка, предназначенная для выполнения различных действий с корзиной.
Класс имеет следующие методы:

 - set items(items: HTMLElement[]): этот метод устанавливает элементы корзины. Если переданный массив items пуст, он отображает сообщение о том, что корзина пуста. В противном случае он обновит содержимое списка с помощью переданных элементов, заменяя предыдущее содержимое.

 - set total(total: number): void: метод, который устанавливает общую сумму всех товаров в корзине.

### Класс BasketItem 
представляет отдельный товар в корзине покупок и обеспечивает отображение информации о нем, а также выполнение различных действий. Он включает в себя свойства и методы, такие как:

 - set counter(value: string): void: устанавливает значение счетчика для данного товара.
 - set title(value: string): void: устанавливает название товара.
 - set price(value: string): void: устанавливает цену товара.

### Класс Card
предназначен для управления карточками в приложении. Он позволяет настраивать различные атрибуты карточек, включая уникальный идентификатор, заголовок, цену, изображение, описание и категорию. Класс обеспечивает методы для взаимодействия с карточками и их элементами.

 - Обязательные свойства:
	 - _id: Уникальный идентификатор карточки.
	 - _title: Заголовок карточки.
	 - _price: Цена карточки.
 - Опциональные свойства:
	 - _description: Описание карточки.
	 - _image: Изображение, связанное с карточкой.
	 - _category: Категория, к которой принадлежит карточка.
	 - _button: Опциональный элемент кнопки.
	 - _categoryColor: Карта (Map), сопоставляющая категории с соответствующими стилями.
Класс реализует геттеры и сеттеры для работы с данными свойствами.

### Класс PaymentForm
PaymentForm – это специализированная форма для управления данными о платеже. Она наследует функциональность базового класса Form и предлагает дополнительные возможности для настройки кнопок выбора методов оплаты и обработки полей, связанных с адресом доставки.

 - Свойства:
	 - container: HTML-элемент, который представляет форму данных о платеже.
	 - events: Объект, предназначенный для работы с событиями в форме.
 - Методы:
	 - set address(value: string): Устанавливает значение поля для адреса доставки.
	 - setPaymentButton(name: string): Активирует состояние для кнопок, отвечающих за выбор метода оплаты.
### Класс ContactsForm
ContactsForm – это специализированная форма, предназначенная для управления контактными данными заказа. Она также наследует класс Form и предоставляет функционал, необходимый для работы с контактной информацией пользователя.

 - Свойства:
	 - container: HTML-элемент формы, содержащей контактные данные.
	 - events: Объект для управления событиями в форме.
 - Методы:
	 - set phone(value: string): Устанавливает значение поля для телефона.
	 - set email(value: string): Устанавливает значение поля для электронной почты.

### Класс Page 
Этот компонент предназначен для управления аспектами страницы в приложении, включая настройку списка продуктов, блокировку и разблокировку страницы, а также обработку событий, связанных с корзиной. 

 - Свойства:
	 - _cardList: элемент списка карточек продуктов (HTMLElement), где отображаются доступные товары.
	 - _basket: элемент корзины (HTMLElement) в заголовке страницы, отражающий текущее состояние корзины.
	 - _basket_counter: элемент, показывающий количество товаров, находящихся в корзине.
	 - _pageWrapper: элемент обертки страницы (HTMLElement), который может быть заблокирован для предотвращения взаимодействия пользователя.
 - Методы класса:
	 - set productList(items: HTMLElement[]): этот метод заменяет содержимое списка карточек продуктов на переданные элементы, обновляя отображение товаров.
	 - set locked(value: boolean): метод для установки состояния блокировки страницы, что позволяет управлять доступом к элементам интерфейса.
### Класс Success
Этот компонент служит для отображения сообщения об успешном завершении какой-либо операции или процесса. Он наследует свойства класса Component и предлагает возможность закрытия сообщения, а также отображает общую сумму операции. Компонент не содержит методов, но включает в себя следующие свойства:

 - container: HTML-элемент, в который рендерится сообщение о завершении операции, информируя пользователя об успехе.
 - actions: объект, представляющий действия, доступные пользователю при взаимодействии с сообщением (например, возможность закрыть уведомление).
 - total: общая сумма операции, которая отображается в сообщении, предоставляя ясное понимание проведенной транзакции.

# Слой Presenter
Слой Presenter в проекте представлен файлом index.ts и реализует свою функциональность через объект класса EventEmitter, который связывает данные и визуальное отображение, инициализируя различные события.
Вот список событий, которые могут быть инициированы:

 - items:change — Это событие срабатывает при изменении массива товаров. Оно вызывает сеттер объекта класса Page и инициирует рендеринг карточек товаров в галерее.

 - card:select — Это событие активируется при клике на карточку товара, получая информацию о выбранном товаре для отображения в модальном окне.

 - preview:changed — При получении данных о конкретном товаре по его идентификатору с сервера, это событие открывает модальное окно и рендерит карточку товара.

 - item:add — Срабатывает при нажатии кнопки "Купить" и добавляет информацию о выбранном товаре в корзину.

 - item:remove — Это событие срабатывает при нажатии кнопки удаления товара из корзины и удаляет товар и его данные.

 - modal:open — Открывает модальное окно при взаимодействии с соответствующей областью, а также блокирует прокрутку страницы.

 - modal:close — Закрывает модальное окно и отключает блокировку прокрутки страницы.

 - order:open — Инициируется клацанием на кнопку "оформить" в корзине, переключая содержимое модального окна на первую вкладку оформления заказа.

 - contacts:open — Переключает содержимое модального окна на форму для ввода контактных данных.

 - contacts:submit — Переключает содержимое модального окна на заглушку с сообщением о успешном выполнении заказа, как ответ на отправку формы.

 - basket:open — Это событие срабатывает при клике на иконку корзины, открывая модальное окно с отображением добавленных товаров. Также инициирует проверку на наличие товаров: в случае пустой корзины кнопка оформления заказа становится неактивной.

 - basketList:changed — Вызывается при изменении содержимого корзины (добавлениях или удалениях товаров).

 - paymentMethod:changed — Активируется при выборе одного из методов оплаты товара.

 - formErrors:change — Срабатывает при изменении состояния ошибок в форме.

 - /^contacts..*:change/ — Вызывается при изменении значений в полях формы контактных данных.

 - /^order..*:change/ — Вызывается при изменении значений в полях формы оформления заказа.

Таким образом, слой Presenter обеспечивает управление взаимодействием между данными и пользовательским интерфейсом, инициируя определенные события, которые позволяют обновлять отображение и обрабатывать действия пользователей.
Презентер служит связующим звеном между моделью и представлением. Он обрабатывает пользовательский ввод, взаимодействует с моделью и обновляет представление на основе данных.
Реализовано с помощью отдельных классов или методов в классах, таких как Form, Basket, OrderPayments, и OrderContacts, которые взаимодействуют с AppState и обновляют View в соответствии с бизнес-логикой. 
Например, эти классы могут:
 - Инициировать валидацию данных, обрабатывая ввод пользователя и взаимодействуя с AppState для выполнения методов validateOrder(), setOrderField().
 - Отправлять данные заказа на сервер через методы класса LarekApi и обновлять представление в случае успешного оформления заказа.
 - Обновлять состояние формы (отображение ошибок, управлять кнопками), опираясь на данные из AppState.


# Основные типы данных

```
export enum Category {
	'софт-скил',
	'другое',
	'дополнительное',
	'кнопка',
	'хард-скил',
}

export interface ICardItem {
	id: string;
	title: string;
	description?: string;
	image?: string;
	category?: Category;
	price: number | null;
	buttonName?: string;
}

export interface ICardList {
	total: number;
	items: ICardItem[];
}

export interface IOrderContacts {
	email: string;
	phone: string;
}

export interface IOrderPayments {
	payment: string;
	address: string;
}

export interface IOrder extends IOrderContacts, IOrderPayments {
	total: number;
	items: string[];
}

export interface IOrderResult {
	id: string;
	total: number;
}

export type FormErrors = Partial<Record<keyof IOrder, string>>;

export interface IAppState {
	basket: ICardItem[];
	catalog: ICardItem[];
	preview: string | null;
	order: IOrder | null;
}
```

Получив массив карточек с сервера, мы отображаем их в галерее по событию. При клике на карточку открывается модальное окно с её данными. Если нажать кнопку "В корзину", товар добавляется или удаляется из неё, если он уже присутствует. Модальное окно можно закрыть, кликнув вне его области или на крестик. При оформлении заказа открывается новое модальное окно для выбора способа оплаты и указания адреса доставки. Если какие-то поля не заполнены, переход к следующему шагу блокируется. Затем заполняются поля для указания электронной почты и телефона. Если ошибок нет, заказ отправляется на сервер. При успешной отправке появляется модальное окно с уведомлением об успешном оформлении заказа и сумме покупки, а корзина очищается.
